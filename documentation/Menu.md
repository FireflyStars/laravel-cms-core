# The Menu

Each module may have a Menu Presence (or any number of them). 
Once a module is added to the CMS, its menu presence will automatically be applied.

For example, if you include the [simple ACL Module](https://github.com/czim/laravel-cms-acl-module) to your CMS,
it will make an access control menu item appear: an expandable group with links to users and roles tables. 

Note that a menu presence is not required for all modules (for instance, if it only offers backend or API-based functionality).


## Grouping Menu Items

It is possible to make custom groups of module menu presences. 
This way, you can create a menu tree to any desired depth to give the menu any structure you want.

To create groups, add a group layout to the `cms-modules.menu.groups` configuration array.
The keys you use in this array serve as references for grouping modules.

Then, configure the presence of any module you want to add in the `cms-modules.menu.modules` array.
Add the module as a key-value pair with the module key as the key, and an array value with at least the `group` key present.

For example, to create a single group and assign a module to it:

```php
<?php
    'menu' => [
        
        'groups' => [
            'some-group' => [
                'label_translated' => 'some.translation.key'
            ]
        ],
        
        'modules' => [
            'models.app-models.post' => [
                // Refers to the key used in the 'groups' array above
                'group' => 'some-group'                
            ],          
        ]
    ]
```

Groups may have children. You can create nested groups this way to any depth (as long as it is supported by your CMS theme).

```php
<?php
    'menu' => [
        
        'groups' => [
            'some-group' => [
                'label_translated' => 'some.translation.key',
                'children'         => [
                    'first-child-group' => [
                        'label' => 'Child Group One'                       
                    ],
                    'second-child-group' => [
                        'label' => 'Child Group Two'                       
                    ]
                ] 
            ]
        ],
        
        'modules' => [
            'models.app-models.post' => [
                'group' => 'some-group'                
            ],          
            'models.app-models.comment' => [
                'group' => 'first-child-group'                
            ],
        ]
    ]
```


Any module not configured in this way will automatically be added to the menu as 'ungrouped', 
which will always appear *after* any configured groups.

Empty groups will not appear on the menu.
This includes groups that exclusively contain menu presences in them that the user currently has no permission to see or use.


Note: you can get a list of available module keys with `php artisan cms:modules:show --keys`.


## Order of Menu Items

Unless a specific order is configured, menu items will be placed in the order in which their modules are loaded.
You can change this by changing the order of items in the `cms-modules.modules` configuration array.

Alternatively, and for more control, the order of menu presences may be determined by adding module keys to 
the `cms-modules.menu.modules` configuration array. 
This means that entries in that array may be key-value pairs (the key being the module key), or string values (module keys),
or a combination of them.

For example, the models module may order a Comment model before a Post model in the menu. 
Reversing this can be done by setting `cms-modules.menu.modules` as follows: 

```php
<?php
    'menu' => [
        
        'modules' => [
            'models.app-models.post',
            'models.app-models.comment',
        ]
    ]
```

Any configured item order will also apply within nested menu groups:

```php
<?php
    'menu' => [
        
        'modules' => [
            'models.app-models.post' => [
                'group' => 'some-group'                
            ],
            'models.app-models.comment' => [
                'group' => 'some-group'                                                       
            ]            
        ]
    ]
```

Note: you can get a list of available module keys with `php artisan cms:modules:show --keys`.


## Menu Presences

A [Menu Presence](https://github.com/czim/laravel-cms-core/blob/master/src/Support/Data/MenuPresence.php) describes
the way a module should appear in the menu.

In most cases, presences will be generated by CMS modules and will not require manual configuration.
This reference is intended for advanced tinkering or customization of menu presences.

Presence attributes are as follows:

- `type` (string), *required*  
    The kind of presence: `'group'`, `'action'`, `'link'`.  
    See the list below for further information.

- `id` (string)  
    An identifier for the presence. This will be used as the HTML `id` attribute for in the menu view partial. 

- `action` (string)  
    Indicates what (CMS) action should be taken when a user clicks the presence label.
    Required for type `'action'` and `'link'`.  
    For type `action`, this should be a (fully prefixed) route name.  
    For type `link`, this should be a URI.  

- `label` (string)  
    A string to show as-is as the presence label.
    Not used if an available `label_translated` key is set.

- `label_translated` (string)  
    A translation key to use for displaying the presence label.
    If set, the `label` value is ignored, *unless* no translation has been set.

- `permissions` (string or array of strings)  
    One or more permissions that are required if a presence is to be displayed for a user.
    If more than one, *all* permissions are required for display.

- `parameters` (array)  
    An array with key-value pairs that should be passed along as parameters for the `action` route.
    This may be used to set some (hard-coded) parameters, which may help to differentiate between navigation links used.

- `image` (string)  
    An indicator that may allow the CMS theme to draw an icon image in front of the presence label text.  
    For the standard CMS theme, [Font Awesome](http://fontawesome.io/icons) class names are supported,
    without the 'fa-' prefix (f.i.: `'home'` for 'fa-home').

- `children` (array of menu presence definitions)  
    Only used for type `group`. 
    A list of presence definitions that should be nested as children under this group presence. 


The available presence `type` values are:

- `group`: An expandable group entity that may be the parent of further nested menu presences.
- `action`: A (CMS) route reference to module pages.
- `link`: A simple hyperlink to be displayed as-is.
- `html`: *not currently used*, may be implemented later for including custom HTML content in the menu.


## Overriding Menu Presences

It is possible to completely override menu presences as defined by CMS modules.

Each menu module configuration array in `cms-modules.menu.modules` may have a presence override like so:

```php
<?php
    'menu' => [
        
        'modules' => [
            
            'models.app-models.post' => [
                'presence' => [
                    'label'            => 'Employees',
                    'type'             => \Czim\CmsCore\Support\Enums\MenuPresenceType\MenuPresenceType::ACTION,
                    'action'           => 'cms::models.model.app-models-employee.index',
                    'parameters'       => [
                        'home' => true,
                    ],
                    'permissions'      => [
                        'models.app-models-employee.*',
                    ],
                ]
            ],            
        ]
    ]
```

This is not recommended unless you have a solid understanding of how the 
[menu presence data objects](https://github.com/czim/laravel-cms-core/blob/master/src/Support/Data/MenuPresence.php) work, 
as well as how route names and permissions are identified.

Keep in mind that `php artisan route:list` may help in getting a clear view of what actions, route names and permissions are available.

Note that this approach is fully compatible with any `group` assignment.


## Debugging

When building menus, the `cms:menu:show` command may be helpful:

This will print the currently configured menu structure to the console: 

```bash
php artisan cms:menu:show
```

This is mainly useful for figuring out how menu items are grouped regardless of active permissions.  
It also helps by showing the translation keys that you may set to localize your menu items.


It should look something like this:

```
Configured groups:

  Group (key: some-group)
  Label       : group display name
  Children :

    Action
    Label       : Testing action
    Action      : testing::index
    Permissions : do.something

    Action
    Label       : Categories
    Transl. key : models.name.categories (nl unset)
    Action      : cms::models.model.app-models-category.index
    Permissions : models.app-models-category.*


Unassigned to configured groups:

  Group
  Label       : Access Control
  Children :

    Action
    Label       : Users
    Action      : cms::acl.users.index
    Permissions : acl.users.show
```

